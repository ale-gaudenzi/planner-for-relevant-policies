<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Resilient Planner: src/search/resilient_planner.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Resilient Planner
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_5e53e25df8c865d23c4f0f620d3a69fb.html">search</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">resilient_planner.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;globals.h&quot;</code><br />
<code>#include &quot;operator.h&quot;</code><br />
<code>#include &quot;option_parser.h&quot;</code><br />
<code>#include &quot;ext/tree_util.hh&quot;</code><br />
<code>#include &quot;timer.h&quot;</code><br />
<code>#include &quot;utilities.h&quot;</code><br />
<code>#include &quot;search_engine.h&quot;</code><br />
<code>#include &quot;policy-repair/regression.h&quot;</code><br />
<code>#include &quot;policy-repair/policy.h&quot;</code><br />
<code>#include &quot;policy-repair/partial_state.h&quot;</code><br />
<code>#include &quot;resilient_node.h&quot;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;list&gt;</code><br />
<code>#include &lt;new&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
<code>#include &lt;stack&gt;</code><br />
<code>#include &lt;tr1/functional&gt;</code><br />
<code>#include &lt;sys/resource.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for resilient_planner.cc:</div>
<div class="dyncontent">
<div class="center"><img src="resilient__planner_8cc__incl.png" border="0" usemap="#src_2search_2resilient__planner_8cc" alt=""/></div>
<map name="src_2search_2resilient__planner_8cc" id="src_2search_2resilient__planner_8cc">
<area shape="rect" title=" " alt="" coords="2375,5,2521,47"/>
<area shape="rect" href="globals_8h_source.html" title=" " alt="" coords="1903,774,1985,801"/>
<area shape="rect" title=" " alt="" coords="1080,931,1139,957"/>
<area shape="rect" title=" " alt="" coords="539,931,602,957"/>
<area shape="rect" title=" " alt="" coords="2295,856,2353,883"/>
<area shape="rect" href="operator_8h_source.html" title=" " alt="" coords="1751,692,1839,719"/>
<area shape="rect" title=" " alt="" coords="2031,931,2111,957"/>
<area shape="rect" href="partial__state_8h_source.html" title=" " alt="" coords="1333,767,1483,808"/>
<area shape="rect" href="option__parser_8h_source.html" title=" " alt="" coords="2485,95,2608,121"/>
<area shape="rect" href="utilities_8h_source.html" title=" " alt="" coords="2931,692,3013,719"/>
<area shape="rect" title=" " alt="" coords="3113,774,3223,801"/>
<area shape="rect" href="tree__util_8hh_source.html" title=" " alt="" coords="3427,692,3523,719"/>
<area shape="rect" href="policy_8h_source.html" title=" " alt="" coords="1804,169,1961,196"/>
<area shape="rect" title=" " alt="" coords="495,468,537,495"/>
<area shape="rect" href="regression_8h_source.html" title=" " alt="" coords="1649,393,1751,420"/>
<area shape="rect" href="search__engine_8h_source.html" title=" " alt="" coords="663,468,803,495"/>
<area shape="rect" href="timer_8h_source.html" title=" " alt="" coords="449,692,517,719"/>
<area shape="rect" href="resilient__node_8h_source.html" title=" " alt="" coords="3022,617,3149,644"/>
<area shape="rect" title=" " alt="" coords="3478,95,3527,121"/>
<area shape="rect" title=" " alt="" coords="3551,95,3667,121"/>
<area shape="rect" title=" " alt="" coords="768,856,832,883"/>
<area shape="rect" title=" " alt="" coords="2175,856,2225,883"/>
<area shape="rect" title=" " alt="" coords="3463,931,3505,957"/>
<area shape="rect" title=" " alt="" coords="2861,856,2921,883"/>
<area shape="rect" title=" " alt="" coords="1762,774,1827,801"/>
<area shape="rect" title=" " alt="" coords="2464,856,2533,883"/>
<area shape="rect" title=" " alt="" coords="2457,774,2532,801"/>
<area shape="rect" href="state_8h_source.html" title=" " alt="" coords="1166,856,1245,883"/>
<area shape="rect" title=" " alt="" coords="2611,169,2669,196"/>
<area shape="rect" title=" " alt="" coords="2959,856,3044,883"/>
<area shape="rect" title=" " alt="" coords="3521,856,3599,883"/>
<area shape="rect" href="option__parser__util_8h_source.html" title=" " alt="" coords="2745,617,2895,644"/>
<area shape="rect" href="heuristic_8h_source.html" title=" " alt="" coords="885,692,976,719"/>
<area shape="rect" title=" " alt="" coords="2814,692,2855,719"/>
<area shape="rect" href="tree_8hh_source.html" title=" " alt="" coords="3450,774,3518,801"/>
<area shape="rect" href="any_8hpp_source.html" title=" " alt="" coords="3037,692,3149,719"/>
<area shape="rect" title=" " alt="" coords="2962,774,3038,801"/>
<area shape="rect" title=" " alt="" coords="3375,856,3446,883"/>
<area shape="rect" title=" " alt="" coords="3170,856,3257,883"/>
<area shape="rect" title=" " alt="" coords="3281,856,3351,883"/>
<area shape="rect" title=" " alt="" coords="2377,856,2439,883"/>
<area shape="rect" href="scalar__evaluator_8h_source.html" title=" " alt="" coords="964,774,1105,801"/>
<area shape="rect" href="operator__cost_8h_source.html" title=" " alt="" coords="513,774,636,801"/>
<area shape="rect" title=" " alt="" coords="1623,244,1697,271"/>
<area shape="rect" href="simulator_8h_source.html" title=" " alt="" coords="1327,319,1422,345"/>
<area shape="rect" href="deadend_8h_source.html" title=" " alt="" coords="1837,319,1928,345"/>
<area shape="rect" href="jit_8h_source.html" title=" " alt="" coords="1942,244,1989,271"/>
<area shape="rect" href="search__space_8h_source.html" title=" " alt="" coords="552,543,675,569"/>
<area shape="rect" href="search__progress_8h_source.html" title=" " alt="" coords="651,617,791,644"/>
<area shape="rect" href="search__node__info_8h_source.html" title=" " alt="" coords="1070,617,1218,644"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa6a18ede93ebee32f9d8ede050060bfc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#aa6a18ede93ebee32f9d8ede050060bfc">resiliency_check</a> (<a class="el" href="classResilientNode.html">ResilientNode</a> node)</td></tr>
<tr class="separator:aa6a18ede93ebee32f9d8ede050060bfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9b775db41306409b3ee8cfcdfcb139a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#ac9b775db41306409b3ee8cfcdfcb139a">replan</a> (<a class="el" href="classResilientNode.html">ResilientNode</a> current_node, <a class="el" href="classSearchEngine.html">SearchEngine</a> *engine)</td></tr>
<tr class="memdesc:ac9b775db41306409b3ee8cfcdfcb139a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to replan from the state contained in current_node to the goal. The search engine is resetted and not recreated to avoid the overhead of the initialization. The plan is saved inside the engine object and can be retrieved from it.  <a href="resilient__planner_8cc.html#ac9b775db41306409b3ee8cfcdfcb139a">More...</a><br /></td></tr>
<tr class="separator:ac9b775db41306409b3ee8cfcdfcb139a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c341899d3b36330fc1636b8d78acdcc"><td class="memItemLeft" align="right" valign="top"><a id="a6c341899d3b36330fc1636b8d78acdcc"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#a6c341899d3b36330fc1636b8d78acdcc">reset_goal</a> ()</td></tr>
<tr class="memdesc:a6c341899d3b36330fc1636b8d78acdcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the goal, used before replanning. Not sure if is really useful, but it was present in prp policy repair. <br /></td></tr>
<tr class="separator:a6c341899d3b36330fc1636b8d78acdcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf3e8f7fc237373f6dde0b5476d42819"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#acf3e8f7fc237373f6dde0b5476d42819">add_fault_model_deadend</a> (<a class="el" href="classResilientNode.html">ResilientNode</a> node)</td></tr>
<tr class="memdesc:acf3e8f7fc237373f6dde0b5476d42819"><td class="mdescLeft">&#160;</td><td class="mdescRight">Regress the state contained in node and add every state-action pair Regr(s,A) to the fault model policy map indexed by the current (k,V).  <a href="resilient__planner_8cc.html#acf3e8f7fc237373f6dde0b5476d42819">More...</a><br /></td></tr>
<tr class="separator:acf3e8f7fc237373f6dde0b5476d42819"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad058227fc490e93e440cb97b1c2051f5"><td class="memItemLeft" align="right" valign="top"><a id="ad058227fc490e93e440cb97b1c2051f5"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#ad058227fc490e93e440cb97b1c2051f5">print_results</a> ()</td></tr>
<tr class="memdesc:ad058227fc490e93e440cb97b1c2051f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print first base policy found and other branches generated from replanning. <br /></td></tr>
<tr class="separator:ad058227fc490e93e440cb97b1c2051f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5edd47cc26a1609925da2b1c1dec9e6"><td class="memItemLeft" align="right" valign="top"><a id="ad5edd47cc26a1609925da2b1c1dec9e6"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#ad5edd47cc26a1609925da2b1c1dec9e6">print_timings</a> ()</td></tr>
<tr class="memdesc:ad5edd47cc26a1609925da2b1c1dec9e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print time statistics. <br /></td></tr>
<tr class="separator:ad5edd47cc26a1609925da2b1c1dec9e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3370e249aa277940b5a838bdb2473c29"><td class="memItemLeft" align="right" valign="top"><a id="a3370e249aa277940b5a838bdb2473c29"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>print_policy_res</b> ()</td></tr>
<tr class="separator:a3370e249aa277940b5a838bdb2473c29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1256e3cad8fc870f75a94254b6aea49"><td class="memItemLeft" align="right" valign="top"><a id="ab1256e3cad8fc870f75a94254b6aea49"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#ab1256e3cad8fc870f75a94254b6aea49">find_in_nodes_list</a> (std::list&lt; <a class="el" href="classResilientNode.html">ResilientNode</a> &gt; res_set, <a class="el" href="classResilientNode.html">ResilientNode</a> node)</td></tr>
<tr class="memdesc:ab1256e3cad8fc870f75a94254b6aea49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the node is present in the resilient nodes list, using the custom minority and equality operators. <br /></td></tr>
<tr class="separator:ab1256e3cad8fc870f75a94254b6aea49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1563020df158bf32be6add7f56bb2859"><td class="memItemLeft" align="right" valign="top"><a id="a1563020df158bf32be6add7f56bb2859"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#a1563020df158bf32be6add7f56bb2859">find_in_op_set</a> (std::set&lt; <a class="el" href="classOperator.html">Operator</a> &gt; op_set, <a class="el" href="classOperator.html">Operator</a> op)</td></tr>
<tr class="memdesc:a1563020df158bf32be6add7f56bb2859"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the operator is present in the operator set. <br /></td></tr>
<tr class="separator:a1563020df158bf32be6add7f56bb2859"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a170f8ea599c0fa6efcd4e5a35cc460a3"><td class="memItemLeft" align="right" valign="top"><a id="a170f8ea599c0fa6efcd4e5a35cc460a3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#a170f8ea599c0fa6efcd4e5a35cc460a3">resource_usage</a> (string o=&quot;&quot;)</td></tr>
<tr class="memdesc:a170f8ea599c0fa6efcd4e5a35cc460a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print memory usage in a particural moment. <br /></td></tr>
<tr class="separator:a170f8ea599c0fa6efcd4e5a35cc460a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a217dbf8b442f20279ea00b898af96f52"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="resilient__planner_8cc.html#a217dbf8b442f20279ea00b898af96f52">main</a> (int argc, const char **argv)</td></tr>
<tr class="separator:a217dbf8b442f20279ea00b898af96f52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab36ed1f1614a7b32f49ba945c6638b7c"><td class="memItemLeft" align="right" valign="top"><a id="ab36ed1f1614a7b32f49ba945c6638b7c"></a>
std::list&lt; <a class="el" href="classResilientNode.html">ResilientNode</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>resilient_nodes</b></td></tr>
<tr class="separator:ab36ed1f1614a7b32f49ba945c6638b7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d1ef44af8a8162d904603da52e90258"><td class="memItemLeft" align="right" valign="top"><a id="a6d1ef44af8a8162d904603da52e90258"></a>
std::stack&lt; <a class="el" href="classResilientNode.html">ResilientNode</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>nodes</b></td></tr>
<tr class="separator:a6d1ef44af8a8162d904603da52e90258"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="acf3e8f7fc237373f6dde0b5476d42819"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf3e8f7fc237373f6dde0b5476d42819">&#9670;&nbsp;</a></span>add_fault_model_deadend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_fault_model_deadend </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classResilientNode.html">ResilientNode</a>&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Regress the state contained in node and add every state-action pair Regr(s,A) to the fault model policy map indexed by the current (k,V). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>Node containing the state to regress and the current (k,V). </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;{</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="classState.html">State</a> state = node.get_state();</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    list&lt;PolicyItem *&gt; de_items;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="classPartialState.html">PartialState</a> *dummy_state = <span class="keyword">new</span> <a class="code" href="classPartialState.html">PartialState</a>();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="classPartialState.html">PartialState</a> *de_state = <span class="keyword">new</span> <a class="code" href="classPartialState.html">PartialState</a>(state);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    generalize_deadend(*de_state);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    vector&lt;PolicyItem *&gt; reg_items;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    g_regressable_ops-&gt;generate_applicable_items(*de_state, reg_items, <span class="keyword">true</span>, g_regress_only_relevant_deadends);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; reg_items.size(); j++)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;Adding in de_items:&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="comment">//reg_items[j]-&gt;dump();</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="structRegressableOperator.html">RegressableOperator</a> *ro = (<a class="code" href="structRegressableOperator.html">RegressableOperator</a> *)(reg_items[j]);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        de_items.push_back(<span class="keyword">new</span> <a class="code" href="structNondetDeadend.html">NondetDeadend</a>(<span class="keyword">new</span> <a class="code" href="classPartialState.html">PartialState</a>(*de_state, *(ro-&gt;op), <span class="keyword">false</span>, dummy_state),</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                                             ro-&gt;op-&gt;nondet_index));</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keyword">delete</span> dummy_state;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="classPolicy.html">Policy</a> *current_deadend_policy = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    current_deadend_policy-&gt;update_policy(de_items);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    g_fault_models.insert(std::make_pair(std::make_pair(g_current_faults, g_current_forbidden_ops), current_deadend_policy));</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    std::set&lt;Operator&gt; v = node.get_deactivated_op();</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">for</span> (std::set&lt;Operator&gt;::iterator it = v.begin(); it != v.end(); ++it)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        std::set&lt;Operator&gt; forbidden_minus_a = g_current_forbidden_ops;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        forbidden_minus_a.erase(*it);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="classPolicy.html">Policy</a> *s_a = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        list&lt;PolicyItem *&gt; s_a_item;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        s_a_item.push_back(<span class="keyword">new</span> <a class="code" href="structNondetDeadend.html">NondetDeadend</a>(<span class="keyword">new</span> <a class="code" href="classPartialState.html">PartialState</a>(state), it-&gt;nondet_index));</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="keywordflow">if</span> (g_fault_models.find(std::make_pair(g_current_faults + 1, forbidden_minus_a)) != g_fault_models.end())</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            g_fault_models.find(std::make_pair(g_current_faults + 1, forbidden_minus_a))-&gt;second-&gt;update_policy(s_a_item);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            s_a-&gt;update_policy(s_a_item);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            g_fault_models.insert(std::make_pair(std::make_pair(g_current_faults + 1, forbidden_minus_a), s_a));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a217dbf8b442f20279ea00b898af96f52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a217dbf8b442f20279ea00b898af96f52">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Assert the settings are consistent. *</p>
<p>Handle JIC Limits *</p>
<p>Initial policy search *</p>
<p>Resilient Alghoritm *</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;{</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    register_event_handlers();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (argc &lt; 2)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        cout &lt;&lt; OptionParser::usage(argv[0]) &lt;&lt; endl;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        exit_with(EXIT_INPUT_ERROR);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">string</span>(argv[1]).compare(<span class="stringliteral">&quot;--help&quot;</span>) != 0)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        read_everything(cin);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classSearchEngine.html">SearchEngine</a> *engine = 0;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    g_policy = 0;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    g_timer_regression.stop();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    g_timer_engine_init.stop();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    g_timer_search.stop();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    g_timer_policy_build.stop();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    g_timer_policy_use.stop();</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    g_timer_regression.reset();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    g_timer_engine_init.reset();</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    g_timer_search.reset();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    g_timer_policy_build.reset();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    g_timer_policy_use.reset();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// the input will be parsed twice:</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// once in dry-run mode, to check for simple input errors,</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// then in normal mode</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    g_timer_engine_init.resume();</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">try</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        OptionParser::parse_cmd_line(argc, argv, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        engine = OptionParser::parse_cmd_line(argc, argv, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">catch</span> (<a class="code" href="structParseError.html">ParseError</a> &amp;pe)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        cerr &lt;&lt; pe &lt;&lt; endl;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        exit_with(EXIT_INPUT_ERROR);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    g_timer_engine_init.stop();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">/* HAZ: Unfortunately, this must go here (as supposed to globals.cc)</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">     *      since we need to know if g_detect_deadends is true or not. */</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">if</span> (g_detect_deadends)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        generate_regressable_ops();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">/* HAZ: We create the policies even if we aren&#39;t using deadends, as</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">     *      they may be consulted by certain parts of the code. */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    g_deadend_policy = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    g_deadend_states = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    g_temporary_deadends = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> (((g_record_online_deadends || g_generalize_deadends) &amp;&amp; !g_detect_deadends) ||</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        ((g_partial_planlocal || g_plan_locally_limited) &amp;&amp; !g_plan_locally) ||</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        (g_optimized_scd &amp;&amp; (g_jic_limit == 0)) ||</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        (g_forgetpolicy &amp;&amp; (g_jic_limit &gt; 0)))</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\n  Parameter Error: Make sure that the set of parameters is consistent.\n&quot;</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;             &lt;&lt; endl;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        exit(0);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;\nTotal allotted time (s): &quot;</span> &lt;&lt; g_jic_limit &lt;&lt; endl;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// If we are going to do a final FSAP-free round, then we modify the</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">//  time limits to give a 50/50 split between the JIC phase and final</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">//  round phase</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordtype">double</span> jic_ratio = 0.5;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">if</span> (g_final_fsap_free_round)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        g_jic_limit *= jic_ratio;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Max time for core JIC (remaining used in final-round repairs): &quot;</span> &lt;&lt; g_jic_limit &lt;&lt; endl;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// Adjust the g_jic_limit so the epochs are handled properly</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">int</span> epochs_remaining = g_num_epochs;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">double</span> single_jic_limit = g_jic_limit / (double)g_num_epochs;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    g_jic_limit = single_jic_limit;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Max time for each of the &quot;</span> &lt;&lt; epochs_remaining &lt;&lt; <span class="stringliteral">&quot; epochs: &quot;</span> &lt;&lt; g_jic_limit &lt;&lt; endl</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;         &lt;&lt; endl;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    g_operators_backup = g_operators;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    engine-&gt;<a class="code" href="classSearchEngine.html#ac26c460dfa1bdd798aa50ebeae28d6f9">reset</a>();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    g_timer_search.resume();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    engine-&gt;search();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    g_timer_search.stop();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    engine-&gt;save_plan_if_necessary();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    engine-&gt;statistics();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    engine-&gt;heuristic_statistics();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Initial search time: &quot;</span> &lt;&lt; g_timer_search &lt;&lt; endl;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Initial total time: &quot;</span> &lt;&lt; g_timer &lt;&lt; endl;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">if</span> (!engine-&gt;found_solution())</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;No solution -- aborting repairs.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        exit(1);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;\nRegressing the plan...&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    list&lt;PolicyItem *&gt; regression_steps = perform_regression(engine-&gt;get_plan(), g_matched_policy, 0, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;\nGenerating an initial policy...&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    g_policy = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    g_policy-&gt;update_policy(regression_steps);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (g_sample_for_depth1_deadends)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        sample_for_depth1_deadends(engine-&gt;get_plan(), <span class="keyword">new</span> <a class="code" href="classPartialState.html">PartialState</a>(g_initial_state()));</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// the resilient algorithm start from here, previously code is cloned from the original prp</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// save the first policy as the original policy</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// g_policy during the execution will contain all the other branches too</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    g_original_policy = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    g_original_policy-&gt;update_policy(regression_steps);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// first filling of the nodes stack with the initial policy</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="classState.html">State</a> current = g_initial_state();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    std::vector&lt;const Operator *&gt; plan = engine-&gt;get_plan();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="classResilientNode.html">ResilientNode</a> initial_node = <a class="code" href="classResilientNode.html">ResilientNode</a>(current, g_max_faults);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    g_current_faults = g_max_faults;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">for</span> (vector&lt;const Operator *&gt;::iterator it = plan.begin(); it != plan.end(); ++it)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="classResilientNode.html">ResilientNode</a> res_node = <a class="code" href="classResilientNode.html">ResilientNode</a>(current, g_max_faults);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        std::set&lt;Operator&gt; post_actions;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        post_actions.insert(*(*it));</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="classResilientNode.html">ResilientNode</a> res_node_f = <a class="code" href="classResilientNode.html">ResilientNode</a>(current, g_max_faults - 1, post_actions);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        nodes.push(res_node);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        nodes.push(res_node_f);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        current = g_state_registry-&gt;get_successor_state(current, *(*it));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160; </div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;\nInitial policy:&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">//g_policy-&gt;dump();</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">    cout &lt;&lt; &quot;PPPPPPPPPPP&quot; &lt;&lt; endl;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">    for (int i = 0; i &lt; g_operators.size(); i++){</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">        cout &lt;&lt; g_operators[i].get_nondet_name() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// main while loop of the algorithm, basically 1:1 with the pseudocode</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordtype">int</span> iteration = 1;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">while</span> (!nodes.empty())</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <a class="code" href="classResilientNode.html">ResilientNode</a> current_node = nodes.top();</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        nodes.pop();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        g_current_faults = current_node.get_k();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        g_current_forbidden_ops = current_node.get_deactivated_op();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        k_v_pair current_pair = std::make_pair(g_current_faults, g_current_forbidden_ops);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;\n----------------------------------------&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;\nIteration:&quot;</span> &lt;&lt; iteration &lt;&lt; endl;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;Current node:&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            current_node.<a class="code" href="classResilientNode.html#a0a6346d921999789bf74c4d71ab1fc8a">dump</a>();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="resilient__planner_8cc.html#aa6a18ede93ebee32f9d8ede050060bfc">resiliency_check</a>(current_node))</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                cout &lt;&lt; <span class="stringliteral">&quot;\nFailed resiliency check.\n&quot;</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                     &lt;&lt; endl;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="resilient__planner_8cc.html#ac9b775db41306409b3ee8cfcdfcb139a">replan</a>(current_node, engine))</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    cout &lt;&lt; <span class="stringliteral">&quot;\nFailed replanning.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <a class="code" href="resilient__planner_8cc.html#acf3e8f7fc237373f6dde0b5476d42819">add_fault_model_deadend</a>(current_node);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    cout &lt;&lt; <span class="stringliteral">&quot;Successfull replanning&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <a class="code" href="classState.html">State</a> current = g_initial_state();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                std::vector&lt;const Operator *&gt; plan = engine-&gt;get_plan();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                <span class="keywordflow">if</span> (current_node.get_k() &gt;= 1)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    <span class="keywordflow">for</span> (vector&lt;const Operator *&gt;::iterator it = plan.begin(); it != plan.end(); ++it)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                        <a class="code" href="classResilientNode.html">ResilientNode</a> res_node = <a class="code" href="classResilientNode.html">ResilientNode</a>(current, g_current_faults, g_current_forbidden_ops);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        std::set&lt;Operator&gt; post_actions = g_current_forbidden_ops;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        post_actions.insert(*(*it));</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        <a class="code" href="classResilientNode.html">ResilientNode</a> res_node_f = <a class="code" href="classResilientNode.html">ResilientNode</a>(current, g_current_faults - 1, post_actions);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                        nodes.push(res_node);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        nodes.push(res_node_f);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                        current = g_state_registry-&gt;get_successor_state(current, *(*it));</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <span class="keywordflow">for</span> (vector&lt;const Operator *&gt;::iterator it = plan.begin(); it != plan.end(); ++it)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <a class="code" href="classResilientNode.html">ResilientNode</a> res_node = <a class="code" href="classResilientNode.html">ResilientNode</a>(current, 0, current_node.get_deactivated_op());</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        resilient_nodes.push_back(res_node);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        current = g_state_registry-&gt;get_successor_state(current, *(*it));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                regression_steps.clear();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                regression_steps = perform_regression(engine-&gt;get_plan(), g_matched_policy, 0, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <a class="code" href="classPolicy.html">Policy</a> *resilient_policy = <span class="keyword">new</span> <a class="code" href="classPolicy.html">Policy</a>();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                resilient_policy-&gt;update_policy(regression_steps);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                g_resilient_policies.insert(std::make_pair(std::make_pair(g_current_faults, g_current_forbidden_ops), resilient_policy));</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                g_policy-&gt;update_policy(regression_steps);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            } </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                cout &lt;&lt; <span class="stringliteral">&quot;\nSuccessfull resiliency check.\n&quot;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                     &lt;&lt; endl;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        iteration++;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">if</span> (g_max_iterations &gt; 0 &amp;&amp; iteration &gt; g_max_iterations)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="resilient__planner_8cc.html#ab1256e3cad8fc870f75a94254b6aea49">find_in_nodes_list</a>(resilient_nodes, initial_node))</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="resilient__planner_8cc.html#ad058227fc490e93e440cb97b1c2051f5">print_results</a>();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\nInitial state is a deadend, problem is not &quot;</span> &lt;&lt; g_max_faults &lt;&lt; <span class="stringliteral">&quot;-resilient!\n&quot;</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;             &lt;&lt; endl;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (1 == g_dump_policy)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Dumping the policy and fsaps...&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        ofstream outfile;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        outfile.open(<span class="stringliteral">&quot;policy.out&quot;</span>, ios::out);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        g_policy-&gt;generate_cpp_input(outfile);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        outfile.close();</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        outfile.open(<span class="stringliteral">&quot;policy.fsap&quot;</span>, ios::out);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        g_deadend_policy-&gt;generate_cpp_input(outfile);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        outfile.close();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (2 == g_dump_policy)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Dumping the policy and fsaps...&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        g_policy-&gt;dump_human_policy();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        g_deadend_policy-&gt;dump_human_policy(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    g_timer.stop();</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="resilient__planner_8cc.html#ad5edd47cc26a1609925da2b1c1dec9e6">print_timings</a>();</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac9b775db41306409b3ee8cfcdfcb139a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9b775db41306409b3ee8cfcdfcb139a">&#9670;&nbsp;</a></span>replan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool replan </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classResilientNode.html">ResilientNode</a>&#160;</td>
          <td class="paramname"><em>current_node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classSearchEngine.html">SearchEngine</a> *&#160;</td>
          <td class="paramname"><em>engine</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Try to replan from the state contained in current_node to the goal. The search engine is resetted and not recreated to avoid the overhead of the initialization. The plan is saved inside the engine object and can be retrieved from it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_node</td><td>The node containing the state to replan from. </td></tr>
    <tr><td class="paramname">engine</td><td>The search engine originally created. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the replan succeds, false otherwise. </dd></dl>
<div class="fragment"><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;{</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Replanning... &quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">//resource_usage(&quot;Before replan&quot;);</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="classPartialState.html">PartialState</a> current_state = <a class="code" href="classPartialState.html">PartialState</a>(current_node.get_state());</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">if</span> (is_deadend(current_state))</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;\nDetected deadend&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    }</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\nCreating initial state.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// set the initial state as the state in the current node</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    g_state_registry-&gt;reset_initial_state();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_variable_name.size(); i++)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        g_initial_state_data[i] = current_state[i];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Creating new engine.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="resilient__planner_8cc.html#a6c341899d3b36330fc1636b8d78acdcc">reset_goal</a>();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    g_timer_engine_init.resume();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    engine-&gt;<a class="code" href="classSearchEngine.html#ac26c460dfa1bdd798aa50ebeae28d6f9">reset</a>();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    g_timer_engine_init.stop();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Searching for a solution.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    g_timer_search.resume();</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    engine-&gt;search();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    g_timer_search.stop();</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">if</span> (engine-&gt;found_solution())</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Solution found&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            engine-&gt;save_plan_if_necessary();</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            engine-&gt;statistics();</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            engine-&gt;heuristic_statistics();</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <span class="comment">//resource_usage(&quot;After replan&quot;);</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">if</span> (g_verbose)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;Replanning failed!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa6a18ede93ebee32f9d8ede050060bfc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6a18ede93ebee32f9d8ede050060bfc">&#9670;&nbsp;</a></span>resiliency_check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool resiliency_check </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classResilientNode.html">ResilientNode</a>&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks if the given node is resilient, using the current global policy to find the applicable next actions then the <a class="el" href="classStateRegistry.html">StateRegistry</a> linked to the state of the node to find the successors of the node. The check is the same as the one in the pseudocode: (⟨s[a], k, V ⟩ ∈ R ∨ s[a] |= G) ∧ ⟨s, k − 1, V ∪ {a}⟩ ∈ R. It also add the node to resilient_nodes list if the check succeds. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>The node to check if is resilient or not. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the node is resilient, false otherwise. </dd></dl>
<div class="fragment"><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;{</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">if</span> (resilient_nodes.empty())</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="classPartialState.html">PartialState</a> state_to_check = <a class="code" href="classPartialState.html">PartialState</a>(node.get_state());</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="resilient__planner_8cc.html#ab1256e3cad8fc870f75a94254b6aea49">find_in_nodes_list</a>(resilient_nodes, node))</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    std::set&lt;Operator&gt; next_actions;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    next_actions.clear();</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    list&lt;PolicyItem *&gt; current_policy = g_policy-&gt;get_items();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="structPolicyItem.html">PolicyItem</a> *goal_step = NULL;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// implementation of getPolicyActions(P,s) in the pseudocode</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">for</span> (std::list&lt;PolicyItem *&gt;::iterator it = current_policy.begin(); it != current_policy.end(); ++it)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <a class="code" href="structRegressionStep.html">RegressionStep</a> *reg_step = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="structRegressionStep.html">RegressionStep</a> *<span class="keyword">&gt;</span>(*it);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">if</span> (!reg_step-&gt;is_goal)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <a class="code" href="classPartialState.html">PartialState</a> policy_state = <a class="code" href="classPartialState.html">PartialState</a>(*reg_step-&gt;state);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span> ((*reg_step-&gt;state).implies(state_to_check) &amp;&amp; !<a class="code" href="resilient__planner_8cc.html#a1563020df158bf32be6add7f56bb2859">find_in_op_set</a>(node.get_deactivated_op(), reg_step-&gt;get_op()))</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                next_actions.insert(reg_step-&gt;get_op());</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reg_step-&gt;is_goal)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            goal_step = reg_step;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="classState.html">State</a> state = node.get_state();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="classStateRegistry.html">StateRegistry</a> *registry = <span class="keyword">const_cast&lt;</span><a class="code" href="classStateRegistry.html">StateRegistry</a> *<span class="keyword">&gt;</span>(&amp;state.get_registry());</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">for</span> (std::set&lt;Operator&gt;::iterator it_o = next_actions.begin(); it_o != next_actions.end(); ++it_o)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="classState.html">State</a> successor = registry-&gt;get_successor_state(node.get_state(), *it_o);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="classPartialState.html">PartialState</a> successor_p = <a class="code" href="classPartialState.html">PartialState</a>(successor);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="classResilientNode.html">ResilientNode</a> successor_r = <a class="code" href="classResilientNode.html">ResilientNode</a>(successor, node.get_k(), node.get_deactivated_op()); <span class="comment">// &lt;s[a], k, V&gt;</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        std::set&lt;Operator&gt; forbidden_plus_current = node.get_deactivated_op();</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        forbidden_plus_current.insert(*it_o);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <a class="code" href="classResilientNode.html">ResilientNode</a> current_r = <a class="code" href="classResilientNode.html">ResilientNode</a>(node.get_state(), node.get_k() - 1, forbidden_plus_current); <span class="comment">// &lt;s, k-1, V U {a}&gt;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="resilient__planner_8cc.html#ab1256e3cad8fc870f75a94254b6aea49">find_in_nodes_list</a>(resilient_nodes, successor_r) || (*goal_step-&gt;state).implies(successor_p)) &amp;&amp; (<a class="code" href="resilient__planner_8cc.html#ab1256e3cad8fc870f75a94254b6aea49">find_in_nodes_list</a>(resilient_nodes, current_r)))</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            resilient_nodes.push_back(node);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="aclassState_html"><div class="ttname"><a href="classState.html">State</a></div><div class="ttdef"><b>Definition:</b> state.h:26</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_ab1256e3cad8fc870f75a94254b6aea49"><div class="ttname"><a href="resilient__planner_8cc.html#ab1256e3cad8fc870f75a94254b6aea49">find_in_nodes_list</a></div><div class="ttdeci">bool find_in_nodes_list(std::list&lt; ResilientNode &gt; set, ResilientNode node)</div><div class="ttdoc">Check if the node is present in the resilient nodes list, using the custom minority and equality oper...</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:517</div></div>
<div class="ttc" id="astructRegressionStep_html"><div class="ttname"><a href="structRegressionStep.html">RegressionStep</a></div><div class="ttdef"><b>Definition:</b> regression.h:67</div></div>
<div class="ttc" id="astructRegressableOperator_html"><div class="ttname"><a href="structRegressableOperator.html">RegressableOperator</a></div><div class="ttdef"><b>Definition:</b> regression.h:54</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_ad058227fc490e93e440cb97b1c2051f5"><div class="ttname"><a href="resilient__planner_8cc.html#ad058227fc490e93e440cb97b1c2051f5">print_results</a></div><div class="ttdeci">void print_results()</div><div class="ttdoc">Print first base policy found and other branches generated from replanning.</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:587</div></div>
<div class="ttc" id="astructParseError_html"><div class="ttname"><a href="structParseError.html">ParseError</a></div><div class="ttdef"><b>Definition:</b> option_parser_util.h:52</div></div>
<div class="ttc" id="aclassSearchEngine_html_ac26c460dfa1bdd798aa50ebeae28d6f9"><div class="ttname"><a href="classSearchEngine.html#ac26c460dfa1bdd798aa50ebeae28d6f9">SearchEngine::reset</a></div><div class="ttdeci">virtual void reset()</div><div class="ttdef"><b>Definition:</b> search_engine.cc:30</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_ad5edd47cc26a1609925da2b1c1dec9e6"><div class="ttname"><a href="resilient__planner_8cc.html#ad5edd47cc26a1609925da2b1c1dec9e6">print_timings</a></div><div class="ttdeci">void print_timings()</div><div class="ttdoc">Print time statistics.</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:619</div></div>
<div class="ttc" id="aclassStateRegistry_html"><div class="ttname"><a href="classStateRegistry.html">StateRegistry</a></div><div class="ttdef"><b>Definition:</b> state_registry.h:101</div></div>
<div class="ttc" id="aclassPolicy_html"><div class="ttname"><a href="classPolicy.html">Policy</a></div><div class="ttdef"><b>Definition:</b> policy.h:26</div></div>
<div class="ttc" id="aclassResilientNode_html"><div class="ttname"><a href="classResilientNode.html">ResilientNode</a></div><div class="ttdef"><b>Definition:</b> resilient_node.h:9</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_acf3e8f7fc237373f6dde0b5476d42819"><div class="ttname"><a href="resilient__planner_8cc.html#acf3e8f7fc237373f6dde0b5476d42819">add_fault_model_deadend</a></div><div class="ttdeci">void add_fault_model_deadend(ResilientNode node)</div><div class="ttdoc">Regress the state contained in node and add every state-action pair Regr(s,A) to the fault model poli...</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:456</div></div>
<div class="ttc" id="aclassResilientNode_html_a0a6346d921999789bf74c4d71ab1fc8a"><div class="ttname"><a href="classResilientNode.html#a0a6346d921999789bf74c4d71ab1fc8a">ResilientNode::dump</a></div><div class="ttdeci">void dump() const</div><div class="ttdoc">Dump node information to the standard output.</div><div class="ttdef"><b>Definition:</b> resilient_node.cc:29</div></div>
<div class="ttc" id="aclassSearchEngine_html"><div class="ttname"><a href="classSearchEngine.html">SearchEngine</a></div><div class="ttdef"><b>Definition:</b> search_engine.h:15</div></div>
<div class="ttc" id="astructPolicyItem_html"><div class="ttname"><a href="structPolicyItem.html">PolicyItem</a></div><div class="ttdef"><b>Definition:</b> regression.h:20</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_a6c341899d3b36330fc1636b8d78acdcc"><div class="ttname"><a href="resilient__planner_8cc.html#a6c341899d3b36330fc1636b8d78acdcc">reset_goal</a></div><div class="ttdeci">void reset_goal()</div><div class="ttdoc">Reset the goal, used before replanning. Not sure if is really useful, but it was present in prp polic...</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:509</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_aa6a18ede93ebee32f9d8ede050060bfc"><div class="ttname"><a href="resilient__planner_8cc.html#aa6a18ede93ebee32f9d8ede050060bfc">resiliency_check</a></div><div class="ttdeci">bool resiliency_check(ResilientNode node)</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:332</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_a1563020df158bf32be6add7f56bb2859"><div class="ttname"><a href="resilient__planner_8cc.html#a1563020df158bf32be6add7f56bb2859">find_in_op_set</a></div><div class="ttdeci">bool find_in_op_set(std::set&lt; Operator &gt; set, Operator op)</div><div class="ttdoc">Check if the operator is present in the operator set.</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:571</div></div>
<div class="ttc" id="aresilient__planner_8cc_html_ac9b775db41306409b3ee8cfcdfcb139a"><div class="ttname"><a href="resilient__planner_8cc.html#ac9b775db41306409b3ee8cfcdfcb139a">replan</a></div><div class="ttdeci">bool replan(ResilientNode current_node, SearchEngine *engine)</div><div class="ttdoc">Try to replan from the state contained in current_node to the goal. The search engine is resetted and...</div><div class="ttdef"><b>Definition:</b> resilient_planner.cc:391</div></div>
<div class="ttc" id="aclassPartialState_html"><div class="ttname"><a href="classPartialState.html">PartialState</a></div><div class="ttdef"><b>Definition:</b> partial_state.h:15</div></div>
<div class="ttc" id="astructNondetDeadend_html"><div class="ttname"><a href="structNondetDeadend.html">NondetDeadend</a></div><div class="ttdef"><b>Definition:</b> regression.h:41</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
